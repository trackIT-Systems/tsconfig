<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet Locate Control CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.css" />
    <!-- Custom CSS -->
    <link href="{{ url_for('static', path='css/style.css') }}" rel="stylesheet">
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet Locate Control JS -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', path='js/app.js') }}"></script>
    <style>
        [x-cloak] { display: none !important; }
        .nav-tabs .nav-link { color: #495057; }
        .nav-tabs .nav-link.active { 
            font-weight: 500;
            color: #0d6efd;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
        }
        .navbar .nav-link.active {
            color: #fff !important;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
        }
        .navbar .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        .navbar .nav-link:hover {
            color: #fff !important;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 0.25rem;
        }
        .config-section { display: none; }
        .config-section.active { display: block; }
        .status-card {
            transition: transform 0.2s ease-in-out;
        }
        .status-card:hover {
            transform: translateY(-2px);
        }
        .status-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #0d6efd;
        }
        /* Log modal mobile optimization */
        @media (max-width: 991.98px) {
            #logModal .modal-dialog {
                margin: 0 !important;
                max-width: 100vw !important;
                height: 100vh;
            }
            #logModal .modal-content {
                height: 100vh;
                border: none;
                border-radius: 0;
            }
        }
    </style>
</head>
<body class="d-flex flex-column h-100" x-data="configManager()" x-init="init()">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">{{ title }}</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#status" 
                           @click.prevent="activeConfig = 'status'"
                           :class="{ 'active': activeConfig === 'status', 'fw-bold': activeConfig === 'status' }">
                            <i class="fas fa-tachometer-alt me-1"></i>Status
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#schedule" 
                           @click.prevent="activeConfig = 'schedule'"
                           :class="{ 'active': activeConfig === 'schedule', 'fw-bold': activeConfig === 'schedule' }">
                            <i class="fas fa-calendar-alt me-1"></i>Schedule
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#radiotracking" 
                           @click.prevent="activeConfig = 'radiotracking'"
                           :class="{ 'active': activeConfig === 'radiotracking', 'fw-bold': activeConfig === 'radiotracking' }">
                            <i class="fas fa-broadcast-tower me-1"></i>Radio Tracking
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" 
                           href="#soundscapepipe" 
                           @click.prevent="activeConfig = 'soundscapepipe'"
                           :class="{ 'active': activeConfig === 'soundscapepipe', 'fw-bold': activeConfig === 'soundscapepipe' }">
                            <i class="fas fa-volume-up me-1"></i>Soundscapepipe
                        </a>
                    </li>
                </ul>
                <div class="navbar-nav ms-auto">
                    <div class="nav-item d-flex align-items-center">
                        <div class="form-check form-switch">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="globalExpertModeToggle" 
                                   x-model="expertMode">
                            <label class="form-check-label text-light" for="globalExpertModeToggle">
                                <i class="fas fa-flask me-1" title="Expert Mode"></i>
                                <span class="d-none d-md-inline">Expert Mode</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
    <div class="container mt-4">
            <div>
                <!-- Alert for messages -->
                <template x-if="message !== ''">
                    <div x-cloak
                         x-transition
                         x-init="if (message && !error && !warning) setTimeout(() => message = '', 10000)"
                         :class="{
                             'alert-success': !error && !warning,
                             'alert-danger': error,
                             'alert-warning': warning
                         }"
                         class="alert d-flex justify-content-between align-items-center" 
                         role="alert">
                        <span x-text="message"></span>
                        <button type="button" 
                                class="btn-close" 
                                x-on:click="message = ''; error = false; warning = false"
                                aria-label="Close">
                        </button>
                    </div>
                </template>

                <!-- Status Section -->
                <div x-show="activeConfig === 'status'" x-cloak>
                    {% include 'status.html' %}
                </div>

                <!-- Schedule Section -->
                <div x-show="activeConfig === 'schedule'" x-cloak>
                    {% include 'schedule.html' %}
                </div>

                <!-- Radio Tracking Section -->
                <div x-show="activeConfig === 'radiotracking'" x-cloak>
                    {% include 'radiotracking.html' %}
                </div>

                <!-- Soundscapepipe Section -->
                <div x-show="activeConfig === 'soundscapepipe'" x-cloak>
                    {% include 'soundscapepipe.html' %}
                </div>
            </div>
    </div>
    </main>
    <!-- Footer -->
    <footer class="footer mt-3 bg-light">
        <div class="container py-3">
            <div class="row align-items-center h-100">
                <div class="col-sm py-2">
                    <span>tsconfig {{ version }} Â© trackIT Systems</span>
                </div>
                <div class="col-sm py-2">
                </div>
                <div class="col-sm py-2">
                </div>
                <div class="col-sm py-2 text-end">
                    <a href="https://trackit.systems" target="_blank"><i class="fa fa-globe lead" title="Website"></i></a>
                    <a href="mailto:info@trackit.systems" alt="send mail"><i class="fa fa-envelope lead" title="E-Mail"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Alpine.js Components -->

    <!-- Log Streaming Modal -->
    <div class="modal fade" id="logModal" tabindex="-1" aria-labelledby="logModalLabel" aria-hidden="true" x-data="logViewer()">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl" style="max-width: 95vw;" data-bs-keyboard="false">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title" id="logModalLabel">
                        <i class="fas fa-file-alt me-2"></i>
                        Service Logs: <span x-text="currentService"></span>
                    </h5>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-0" style="height: 70vh;">
                    <div class="h-100 bg-dark text-light font-monospace small overflow-auto position-relative" 
                         id="logContainer" 
                         style="padding: 1rem; white-space: pre-wrap;">
                        <!-- Empty state indicator (positioned absolutely to center in container) -->
                        <div x-show="!isStreaming && logs.length === 0" 
                             class="position-absolute top-50 start-50 translate-middle text-center text-muted">
                            <i class="fas fa-file-alt fa-3x mb-3 d-block"></i>
                            <p class="mb-0">No logs to display</p>
                        </div>
                        <!-- Loading indicator (positioned absolutely to center in container) -->
                        <div x-show="isStreaming && logs.length === 0" 
                             class="position-absolute top-50 start-50 translate-middle text-center text-muted">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mb-0">Connecting to log stream...</p>
                        </div>
                        <!-- Log lines (normal document flow) -->
                        <template x-for="(log, index) in logs" :key="index">
                            <div class="log-line" x-text="log"></div>
                        </template>
                        <!-- Error indicator -->
                        <div x-show="streamError" class="text-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span x-text="streamError"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="d-flex justify-content-between w-100 align-items-center">
                        <div class="small text-muted">
                            <span x-text="logs.length"></span> lines
                            <span x-show="isStreaming" class="text-success">
                                <i class="fas fa-circle fa-xs me-1"></i>Streaming
                            </span>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-warning" @click="restartService()" :disabled="!currentService">
                                <i class="fas fa-redo me-1"></i>Restart Service
                            </button>
                            <button type="button" class="btn btn-outline-danger" @click="clearLogs()">
                                <i class="fas fa-trash me-1"></i>Clear
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 
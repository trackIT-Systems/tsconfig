<!DOCTYPE html>
<html lang="en" class="h-100" x-data="configManager()" x-init="init()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title x-text="`tsconfig | ${hostname}`">tsconfig | Loading...</title>
    
    <!-- Base URL and config group for JavaScript -->
    <script>
        window.BASE_URL = "{{ base_url or '' }}";
        window.INITIAL_CONFIG_GROUP = "{{ config_group or '' }}";
    </script>
    
    <!-- Common CSS -->
    <link href="{{ base_url }}/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ base_url }}/static/vendor/leaflet/css/leaflet.css" />
    <link rel="stylesheet" href="{{ base_url }}/static/vendor/leaflet-locate/css/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="{{ base_url }}/static/vendor/leaflet-vector-markers/css/leaflet-vector-markers.css" />
    <link rel="stylesheet" href="{{ base_url }}/static/vendor/fontawesome/css/all.min.css">
    <link href="{{ base_url }}/static/css/style.css" rel="stylesheet">
    
    <!-- Common JS -->
    <script src="{{ base_url }}/static/vendor/leaflet/js/leaflet.js"></script>
    <script src="{{ base_url }}/static/vendor/leaflet-vector-markers/js/leaflet-vector-markers.min.js"></script>
    <script src="{{ base_url }}/static/vendor/leaflet-locate/js/L.Control.Locate.min.js"></script>
    <script src="{{ base_url }}/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="d-flex flex-column h-100">
    {% include 'partials/navbar.html' %}
    
    <!-- Global Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1200;" id="globalToastContainer">
        <div class="toast" id="globalToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="toast-icon me-2 fas fa-info-circle text-primary"></i>
                <strong class="me-auto toast-title">tsconfig</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Dynamic message content -->
            </div>
        </div>
    </div>

    <main>
        <div class="container mt-4">
            {% block content %}{% endblock %}
        </div>
    </main>
    
    {% include 'partials/footer.html' %}
    {% if not is_server_mode %}
    {% include 'partials/log_modal.html' %}
    {% include 'partials/shell_modal.html' %}
    {% endif %}
    
    {% block extra_body %}{% endblock %}
    
    <!-- Load toast utility first -->
    <script type="module" src="{{ base_url }}/static/js/utils/toastUtils.js"></script>
    
    <!-- Load authentication module (only active in server mode with OIDC) -->
    <script type="module" src="{{ base_url }}/static/js/auth.js"></script>
    
    <!-- Load app modules FIRST - these will expose components to window -->
    <script type="module" src="{{ base_url }}/static/js/app.js"></script>
    
    <!-- After modules signal ready, dynamically load Alpine.js -->
    <script>
        // Wait for modules to be ready before loading Alpine
        window.addEventListener('app-modules-ready', () => {
            // Dynamically load Alpine.js script
            const alpineScript = document.createElement('script');
            alpineScript.src = "{{ base_url }}/static/vendor/alpinejs/js/cdn.min.js";
            alpineScript.onerror = () => {
                console.error('Failed to load Alpine.js');
            };
            document.body.appendChild(alpineScript);
        });
    </script>
</body>
</html> 
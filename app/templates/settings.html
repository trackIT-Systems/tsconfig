<!-- System Settings (Schedule + SSH Keys) -->
<div x-show="activeConfig === 'settings'" x-cloak x-data="{ 
    systemTab: 'schedule',
    
    init() {
        // Parse subtab from URL hash (format: #settings/subtab)
        const parseSubtab = () => {
            const hash = window.location.hash.slice(1); // Remove #
            const parts = hash.split('/');
                if (parts[0] === 'settings' && parts.length > 1) {
                const subtab = parts[1];
                if (['schedule', 'sshkeys', 'updates', 'configupload', 'network'].includes(subtab)) {
                    return subtab;
                }
            }
            return 'schedule'; // Default
        };
        
        this.systemTab = parseSubtab();
        
        // Watch for systemTab changes and update URL
        this.$watch('systemTab', (value) => {
            const currentHash = window.location.hash.slice(1);
            const parts = currentHash.split('/');
            if (parts[0] === 'settings') {
                window.location.hash = `settings/${value}`;
            }
        });
        
        // Listen for hash changes (back/forward browser navigation)
        window.addEventListener('hashchange', () => {
            const newSubtab = parseSubtab();
            if (newSubtab !== this.systemTab) {
                this.systemTab = newSubtab;
            }
        });
    }
}">
    <div class="row">
        <div class="col">
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs mb-3" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link" 
                            :class="{ 'active': systemTab === 'schedule' }"
                            @click="systemTab = 'schedule'"
                            type="button">
                        <i class="fas fa-calendar-alt me-1"></i>
                        Schedule
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" 
                            :class="{ 'active': systemTab === 'sshkeys' }"
                            @click="systemTab = 'sshkeys'"
                            type="button">
                        <i class="fas fa-key me-1"></i>
                        SSH Keys
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" 
                            :class="{ 'active': systemTab === 'updates' }"
                            @click="systemTab = 'updates'"
                            type="button">
                        <i class="fas fa-sync-alt me-1"></i>
                        Updates
                    </button>
                </li>
                <li class="nav-item" role="presentation" x-show="!serverMode">
                    <button class="nav-link" 
                            :class="{ 'active': systemTab === 'network' }"
                            @click="systemTab = 'network'"
                            type="button">
                        <i class="fas fa-network-wired me-1"></i>
                        Network
                    </button>
                </li>
                <li class="nav-item ms-auto" role="presentation" x-show="!serverMode">
                    <button class="nav-link" 
                            :class="{ 'active': systemTab === 'configupload' }"
                            @click="systemTab = 'configupload'"
                            type="button">
                        <i class="fas fa-file-archive me-1"></i>
                        Config Upload
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Schedule Tab -->
                <div x-show="systemTab === 'schedule'">
                    <div class="card" x-data="scheduleConfig()" x-init="init()" x-destroy="cleanup()">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <!-- Service status elements - hidden in server mode -->
                                <template x-if="!serverMode">
                                    <div class="d-flex align-items-center">
                                        <h5 class="card-title mb-0 me-2">tsschedule</h5>
                                        <!-- Service Status Indicator -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge d-flex align-items-center gap-1" 
                                                    :class="{
                                                        'bg-success': serviceStatus.active && serviceStatus.status === 'active',
                                                        'bg-danger': !serviceStatus.active && serviceStatus.status !== 'not-found' && serviceStatus.status !== 'timeout' && serviceStatus.status !== 'error' && serviceStatus.status !== 'unknown',
                                                        'bg-secondary': serviceStatus.status === 'not-found' || serviceStatus.status === 'unknown',
                                                        'bg-warning': serviceStatus.status === 'timeout' || serviceStatus.status === 'error'
                                                    }">
                                                <span class="d-none d-sm-inline" x-text="serviceStatus.active ? 'Active' : (serviceStatus.status === 'not-found' ? 'Not Found' : (serviceStatus.status === 'timeout' || serviceStatus.status === 'error' ? 'Error' : 'Inactive'))"></span>
                                                <span class="d-sm-none" x-text="serviceStatus.active ? 'ON' : 'OFF'"></span>
                                            </span>
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                <span x-text="serviceStatus.uptime"></span>
                                            </small>
                                        </div>
                                    </div>
                                </template>
                                <!-- Server mode: Simple title -->
                                <template x-if="serverMode">
                                    <h5 class="card-title mb-0">Schedule Configuration</h5>
                                </template>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <!-- Start/Stop button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-success': (!serviceStatus.active && getServiceStartStopState('tsschedule') === 'idle') || getServiceStartStopState('tsschedule') === 'started',
                                            'btn-success': getServiceStartStopState('tsschedule') === 'starting',
                                            'btn-outline-danger': (serviceStatus.active && getServiceStartStopState('tsschedule') === 'idle') || getServiceStartStopState('tsschedule') === 'stopped',
                                            'btn-danger': getServiceStartStopState('tsschedule') === 'stopping'
                                        }"
                                        @click="performStartStopAction('tsschedule', serviceStatus.active ? 'stop' : 'start')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceStartStopState('tsschedule') === 'starting' || getServiceStartStopState('tsschedule') === 'stopping'"
                                        :title="serviceStatus.active ? 'Stop service' : 'Start service'"
                                        x-show="!serverMode">
                                    <template x-if="!serviceStatus.active && getServiceStartStopState('tsschedule') === 'idle'">
                                        <i class="fas fa-play"></i>
                                    </template>
                                    <template x-if="serviceStatus.active && getServiceStartStopState('tsschedule') === 'idle'">
                                        <i class="fas fa-stop"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsschedule') === 'starting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsschedule') === 'stopping'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsschedule') === 'started'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsschedule') === 'stopped'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <!-- Restart button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-warning': getServiceRestartState('tsschedule') === 'idle',
                                            'btn-primary': getServiceRestartState('tsschedule') === 'restarting',
                                            'btn-outline-success': getServiceRestartState('tsschedule') === 'restarted'
                                        }"
                                        @click="performAction('tsschedule', 'restart')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceRestartState('tsschedule') === 'restarting'"
                                        title="Restart service"
                                        x-show="!serverMode">
                                    <template x-if="getServiceRestartState('tsschedule') === 'idle'">
                                        <i class="fas fa-redo"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('tsschedule') === 'restarting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('tsschedule') === 'restarted'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <button type="button" 
                                        class="btn btn-outline-info btn-sm" 
                                        @click="streamLogs('tsschedule')"
                                        title="View tsschedule service logs"
                                        x-show="!serverMode">
                                    <i class="fas fa-file-alt me-1"></i>
                                    Logs
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Schedule Configuration Form -->
                            <form @submit.prevent="saveConfig">
                                <!-- General Section -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-cogs me-2"></i>
                                        General
                                    </h6>
                                    
                                    <div class="row">
                                        <!-- Force On Column -->
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" 
                                                            type="checkbox" 
                                                            x-model="config.force_on" 
                                                            id="forceOn">
                                                    <label class="form-check-label" for="forceOn">Force On</label>
                                                </div>
                                                <div class="form-text">
                                                    When enabled, this disables all scheduling and makes the tracker stay on permanently.
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Button Delay Column -->
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Button Delay (HH:MM)</label>
                                                <input type="text" 
                                                        class="form-control" 
                                                        x-model="config.button_delay" 
                                                        pattern="[0-9]{2}:[0-9]{2}" 
                                                        required>
                                                <div class="form-text">
                                                    This is the duration the tracker will stay on after manually pressing the power button or reconnecting power.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Schedule Entries Section -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        Schedule Entries
                                    </h6>
                                    <div class="form-text mb-3">Define time spans during which the tracker will be on. You can create multiple entries, and overlapping entries are allowed - the tracker will stay on continuously if entries overlap.</div>
                                    <template x-for="(entry, index) in config.schedule" :key="index">
                                        <div class="rounded-2 p-3 mb-2" 
                                             :class="isFirstMaintenanceEntry(index) ? 'bg-light border border-info border-2' : 'bg-light'">
                                            <div class="d-flex align-items-center justify-content-between mb-3">
                                                <div class="d-flex align-items-center flex-grow-1 me-3">
                                                    <i class="fas fa-clock text-primary me-2"></i>
                                                    <input type="text" 
                                                            class="form-control form-control-sm fw-medium" 
                                                            :class="isMaintenanceEntryProtected(index) ? 'bg-secondary bg-opacity-10 text-muted' : ''"
                                                            x-model="entry.name" 
                                                            :readonly="isMaintenanceEntryProtected(index)"
                                                            @blur='if (checkDuplicateMaintenanceName(entry.name, index)) { showMessage("A schedule entry named \"maintenance\" already exists. Only one maintenance entry is allowed.", true); entry.name = ""; }'
                                                            placeholder="Enter schedule name..." 
                                                            required>
                                                    <template x-if="isFirstMaintenanceEntry(index)">
                                                        <span class="badge bg-info text-white ms-2" title="This schedule entry is protected">
                                                            <i class="fas fa-lock me-1"></i>System maintenance
                                                        </span>
                                                    </template>
                                                </div>
                                                <template x-if="!isMaintenanceEntryProtected(index)">
                                                <button type="button" 
                                                        class="btn btn-outline-danger btn-sm" 
                                                        @click="removeSchedule(index)"
                                                        title="Remove schedule">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                </template>
                                                <template x-if="isMaintenanceEntryProtected(index)">
                                                    <button type="button" 
                                                            class="btn btn-outline-secondary btn-sm" 
                                                            disabled
                                                            title="Cannot delete maintenance schedule entry. Enable expert mode to delete it.">
                                                        <i class="fas fa-lock"></i>
                                                    </button>
                                                </template>
                                            </div>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <label class="text-success fw-semibold small mb-0 schedule-label">
                                                            <i class="fas fa-play me-1"></i><span class="d-none d-md-inline">Start</span>
                                                        </label>
                                                        <div class="row g-1 flex-grow-1">
                                                            <div class="col">
                                                                <select class="form-select form-select-sm" 
                                                                        x-model="entry.startReference"
                                                                        @change="updateTimeString(entry, 'start')">
                                                                    <option value="time">Clock Time</option>
                                                                    <option value="sunrise">Sunrise</option>
                                                                    <option value="sunset">Sunset</option>
                                                                    <option value="dawn">Dawn</option>
                                                                    <option value="dusk">Dusk</option>
                                                                    <option value="noon">Solar Noon</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <select class="form-select form-select-sm" 
                                                                        style="width: 70px;"
                                                                        x-model="entry.startSign"
                                                                        @change="updateTimeString(entry, 'start')"
                                                                        :disabled="entry.startReference === 'time'"
                                                                        :value="entry.startReference === 'time' ? '+' : entry.startSign">
                                                                    <option value="+">+</option>
                                                                    <option value="-">-</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <input type="time" 
                                                                        class="form-control form-control-sm" 
                                                                        style="width: 110px;"
                                                                        x-model="entry.startOffset"
                                                                        @change="updateTimeString(entry, 'start')">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <label class="text-danger fw-semibold small mb-0 schedule-label">
                                                            <i class="fas fa-stop me-1"></i><span class="d-none d-md-inline">Stop</span>
                                                        </label>
                                                        <div class="row g-1 flex-grow-1">
                                                            <div class="col">
                                                                <select class="form-select form-select-sm" 
                                                                        x-model="entry.stopReference"
                                                                        @change="updateTimeString(entry, 'stop')">
                                                                    <option value="time">Clock Time</option>
                                                                    <option value="sunrise">Sunrise</option>
                                                                    <option value="sunset">Sunset</option>
                                                                    <option value="dawn">Dawn</option>
                                                                    <option value="dusk">Dusk</option>
                                                                    <option value="noon">Solar Noon</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <select class="form-select form-select-sm" 
                                                                        style="width: 70px;"
                                                                        x-model="entry.stopSign"
                                                                        @change="updateTimeString(entry, 'stop')"
                                                                        :disabled="entry.stopReference === 'time'"
                                                                        :value="entry.stopReference === 'time' ? '+' : entry.stopSign">
                                                                    <option value="+">+</option>
                                                                    <option value="-">-</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <input type="time" 
                                                                        class="form-control form-control-sm" 
                                                                        style="width: 110px;"
                                                                        x-model="entry.stopOffset"
                                                                        @change="updateTimeString(entry, 'stop')">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <div class="mt-3">
                                        <button type="button" 
                                                class="btn btn-outline-primary btn-sm add-schedule-btn" 
                                                @click="addSchedule">
                                            <i class="fas fa-plus me-2"></i>
                                            Add Schedule Entry
                                        </button>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="d-flex justify-content-between gap-2">
                                    <div class="d-flex gap-2">
                                        <button type="button" 
                                                class="btn btn-outline-secondary" 
                                                @click="refreshConfig()">
                                            Reset
                                        </button>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" 
                                                class="btn"
                                                :class="{
                                                    'btn-success': saveState === 'idle',
                                                    'btn-primary': saveState === 'saving',
                                                    'btn-outline-success': saveState === 'saved'
                                                }"
                                                :disabled="saveState === 'saving'">
                                            <template x-if="saveState === 'idle'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-save me-1"></i>
                                                    Save
                                                </div>
                                            </template>
                                            <template x-if="saveState === 'saving'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Saving...
                                                </div>
                                            </template>
                                            <template x-if="saveState === 'saved'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-check me-1"></i>
                                                    Saved!
                                                </div>
                                            </template>
                                        </button>
                                        <button type="button" 
                                                class="btn"
                                                :class="{
                                                    'btn-warning': saveRestartState === 'idle',
                                                    'btn-primary': saveRestartState === 'saving' || saveRestartState === 'restarting',
                                                    'btn-outline-success': saveRestartState === 'saved'
                                                }"
                                                @click="saveAndRestartService()"
                                                :disabled="saveRestartState === 'saving' || saveRestartState === 'restarting'"
                                                x-show="!serverMode">
                                            <template x-if="saveRestartState === 'idle'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-save me-1"></i>
                                                    <i class="fas fa-redo me-1"></i>
                                                    Save & Restart
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'saving'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Saving...
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'restarting'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Restarting...
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'saved'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-check me-1"></i>
                                                    Saved & Restarted!
                                                </div>
                                            </template>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- SSH Keys Tab -->
                <div x-show="systemTab === 'sshkeys'">
                    <div class="card" x-data="sshKeysConfig()" x-init="init()" x-destroy="cleanup()">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <!-- Service status elements - hidden in server mode -->
                                <template x-if="!serverMode">
                                    <div class="d-flex align-items-center">
                                        <h5 class="card-title mb-0 me-2">ssh</h5>
                                        <!-- Service Status Indicator -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge d-flex align-items-center gap-1" 
                                                    :class="{
                                                        'bg-success': serviceStatus.active && serviceStatus.status === 'active',
                                                        'bg-danger': !serviceStatus.active && serviceStatus.status !== 'not-found' && serviceStatus.status !== 'timeout' && serviceStatus.status !== 'error' && serviceStatus.status !== 'unknown',
                                                        'bg-secondary': serviceStatus.status === 'not-found' || serviceStatus.status === 'unknown',
                                                        'bg-warning': serviceStatus.status === 'timeout' || serviceStatus.status === 'error'
                                                    }">
                                                <span class="d-none d-sm-inline" x-text="serviceStatus.active ? 'Active' : (serviceStatus.status === 'not-found' ? 'Not Found' : (serviceStatus.status === 'timeout' || serviceStatus.status === 'error' ? 'Error' : 'Inactive'))"></span>
                                                <span class="d-sm-none" x-text="serviceStatus.active ? 'ON' : 'OFF'"></span>
                                            </span>
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                <span x-text="serviceStatus.uptime"></span>
                                            </small>
                                        </div>
                                    </div>
                                </template>
                                <!-- Server mode: Simple title -->
                                <template x-if="serverMode">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-key me-2"></i>
                                        SSH Authorized Keys
                                    </h5>
                                </template>
                            </div>
                            <div class="d-flex align-items-center gap-2" x-show="!serverMode">
                                <!-- Start/Stop button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-success': (!serviceStatus.active && getServiceStartStopState('ssh') === 'idle') || getServiceStartStopState('ssh') === 'started',
                                            'btn-success': getServiceStartStopState('ssh') === 'starting',
                                            'btn-outline-danger': (serviceStatus.active && getServiceStartStopState('ssh') === 'idle') || getServiceStartStopState('ssh') === 'stopped',
                                            'btn-danger': getServiceStartStopState('ssh') === 'stopping'
                                        }"
                                        @click="performStartStopAction('ssh', serviceStatus.active ? 'stop' : 'start')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceStartStopState('ssh') === 'starting' || getServiceStartStopState('ssh') === 'stopping'"
                                        :title="serviceStatus.active ? 'Stop service' : 'Start service'">
                                    <template x-if="!serviceStatus.active && getServiceStartStopState('ssh') === 'idle'">
                                        <i class="fas fa-play"></i>
                                    </template>
                                    <template x-if="serviceStatus.active && getServiceStartStopState('ssh') === 'idle'">
                                        <i class="fas fa-stop"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('ssh') === 'starting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('ssh') === 'stopping'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('ssh') === 'started'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('ssh') === 'stopped'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <!-- Restart button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-warning': getServiceRestartState('ssh') === 'idle',
                                            'btn-primary': getServiceRestartState('ssh') === 'restarting',
                                            'btn-outline-success': getServiceRestartState('ssh') === 'restarted'
                                        }"
                                        @click="performAction('ssh', 'restart')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceRestartState('ssh') === 'restarting'"
                                        title="Restart service">
                                    <template x-if="getServiceRestartState('ssh') === 'idle'">
                                        <i class="fas fa-redo"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('ssh') === 'restarting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('ssh') === 'restarted'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <button type="button" 
                                        class="btn btn-outline-info btn-sm" 
                                        @click="streamLogs('ssh')"
                                        title="View ssh service logs">
                                    <i class="fas fa-file-alt me-1"></i>
                                    Logs
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Existing Keys List -->
                            <div class="mb-4">
                                <h6 class="border-bottom pb-2">
                                    <i class="fas fa-list me-2"></i>
                                    Authorized Keys (<span x-text="keys.length"></span>)
                                </h6>
                                
                                <template x-if="keys.length === 0">
                                    <div class="text-muted text-center py-4">
                                        <i class="fas fa-key fa-3x mb-3 opacity-25"></i>
                                        <p>No SSH keys configured yet. Add one below to enable SSH access.</p>
                                    </div>
                                </template>

                                <template x-if="keys.length > 0">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th style="width: 120px;">Type</th>
                                                    <th style="width: 100px;">Source</th>
                                                    <th>Key Preview / Comment</th>
                                                    <th style="width: 100px;" class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template x-for="(key, index) in sortedKeys" :key="index">
                                                    <tr :class="key.source === 'server' ? 'table-secondary' : ''">
                                                        <td>
                                                            <span class="badge bg-secondary" x-text="key.key_type"></span>
                                                        </td>
                                                        <td>
                                                            <span class="badge" 
                                                                  :class="key.source === 'server' ? 'bg-info' : 'bg-success'"
                                                                  :title="key.source === 'server' ? 'Managed via config upload' : 'Managed via this UI'"
                                                                  x-text="key.source === 'server' ? 'Server' : 'User'">
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <code class="small text-truncate" style="max-width: 500px;" x-text="key.key_data ? key.key_data.substring(0, 40) + '...' : ''"></code>
                                                                <small class="text-muted" x-show="key.comment" x-text="key.comment"></small>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <button type="button" 
                                                                    class="btn btn-outline-danger btn-sm" 
                                                                    @click="removeKey(key)"
                                                                    x-show="serverMode ? (key.index !== 0) : (key.source !== 'server')"
                                                                    :title="serverMode && key.index === 0 ? 'Cannot remove first key (prevents lockout)' : 'Remove this key'">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </template>
                            </div>

                            <!-- Add New Key Form -->
                            <div>
                                <h6 class="border-bottom pb-2">
                                    <i class="fas fa-plus me-2"></i>
                                    Add New SSH Key
                                </h6>
                                <form @submit.prevent="addKey">
                                    <div class="mb-2">
                                        <label class="form-label">SSH Public Key</label>
                                        <textarea class="form-control font-monospace small" 
                                                  x-model="newKey"
                                                  rows="4" 
                                                  placeholder="Paste your SSH public key here (e.g., ssh-rsa AAAAB3NzaC1yc2EA... user@hostname)"
                                                  required></textarea>
                                        <div class="form-text">
                                            Paste the entire contents of your SSH public key file.
                                        </div>
                                    </div>
                                    <div class="text-end mt-1">
                                        <button type="submit" 
                                                class="btn btn-success"
                                                :disabled="!newKey.trim() || loading">
                                            <template x-if="!loading">
                                                <span>
                                                    <i class="fas fa-plus me-1"></i>
                                                    Add Key
                                                </span>
                                            </template>
                                            <template x-if="loading">
                                                <span>
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Saving...
                                                </span>
                                            </template>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Import Keys from Platform -->
                            <div class="mt-4">
                                <h6 class="border-bottom pb-2">
                                    <i class="fas fa-download me-2"></i>
                                    Import SSH Keys from Platform
                                </h6>
                                
                                <!-- GitHub Import -->
                                <div class="row mb-3">
                                    <div class="col-md-8">
                                        <label class="form-label">GitHub Username</label>
                                        <input type="text" 
                                               class="form-control" 
                                               x-model="githubUsername" 
                                               placeholder="Enter GitHub username"
                                               @keydown.enter="importFromGitHub()">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button type="button" 
                                                class="btn btn-success w-100"
                                                @click="importFromGitHub()"
                                                :disabled="!githubUsername.trim() || loading">
                                            <template x-if="!loading">
                                                <span>
                                                    <i class="fab fa-github me-1"></i>
                                                    Import from GitHub
                                                </span>
                                            </template>
                                            <template x-if="loading">
                                                <span>
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Importing...
                                                </span>
                                            </template>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Launchpad Import -->
                                <div class="row">
                                    <div class="col-md-8">
                                        <label class="form-label">Launchpad Username</label>
                                        <input type="text" 
                                               class="form-control" 
                                               x-model="launchpadUsername" 
                                               placeholder="Enter Launchpad username"
                                               @keydown.enter="importFromLaunchpad()">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button type="button" 
                                                class="btn btn-success w-100"
                                                @click="importFromLaunchpad()"
                                                :disabled="!launchpadUsername.trim() || loading">
                                            <template x-if="!loading">
                                                <span>
                                                    <i class="fas fa-rocket me-1"></i>
                                                    Import from Launchpad
                                                </span>
                                            </template>
                                            <template x-if="loading">
                                                <span>
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Importing...
                                                </span>
                                            </template>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-text">
                                    Import public SSH keys from GitHub or Launchpad user profiles.
                                </div>
                            </div>

                            <!-- Toast notifications appear in top-right corner -->
                        </div>
                    </div>
                </div>

                <!-- Updates Tab -->
                <div x-show="systemTab === 'updates'">
                    <div class="card" x-data="tsupdateConfig()" x-init="init()" x-destroy="cleanup()">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <!-- Service status elements - hidden in server mode -->
                                <template x-if="!serverMode">
                                    <div class="d-flex align-items-center">
                                        <h5 class="card-title mb-0 me-2">tsupdate</h5>
                                        <!-- Service Status Indicator -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge d-flex align-items-center gap-1" 
                                                    :class="{
                                                        'bg-success': serviceStatus.active && serviceStatus.status === 'active',
                                                        'bg-danger': !serviceStatus.active && serviceStatus.status !== 'not-found' && serviceStatus.status !== 'timeout' && serviceStatus.status !== 'error' && serviceStatus.status !== 'unknown',
                                                        'bg-secondary': serviceStatus.status === 'not-found' || serviceStatus.status === 'unknown',
                                                        'bg-warning': serviceStatus.status === 'timeout' || serviceStatus.status === 'error'
                                                    }">
                                                <span class="d-none d-sm-inline" x-text="serviceStatus.active ? 'Active' : (serviceStatus.status === 'not-found' ? 'Not Found' : (serviceStatus.status === 'timeout' || serviceStatus.status === 'error' ? 'Error' : 'Inactive'))"></span>
                                                <span class="d-sm-none" x-text="serviceStatus.active ? 'ON' : 'OFF'"></span>
                                            </span>
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                <span x-text="serviceStatus.uptime"></span>
                                            </small>
                                        </div>
                                    </div>
                                </template>
                                <!-- Server mode: Simple title -->
                                <template x-if="serverMode">
                                    <h5 class="card-title mb-0">Update Configuration</h5>
                                </template>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <!-- Start/Stop button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-success': (!serviceStatus.active && getServiceStartStopState('tsupdate') === 'idle') || getServiceStartStopState('tsupdate') === 'started',
                                            'btn-success': getServiceStartStopState('tsupdate') === 'starting',
                                            'btn-outline-danger': (serviceStatus.active && getServiceStartStopState('tsupdate') === 'idle') || getServiceStartStopState('tsupdate') === 'stopped',
                                            'btn-danger': getServiceStartStopState('tsupdate') === 'stopping'
                                        }"
                                        @click="performStartStopAction('tsupdate', serviceStatus.active ? 'stop' : 'start')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceStartStopState('tsupdate') === 'starting' || getServiceStartStopState('tsupdate') === 'stopping'"
                                        :title="serviceStatus.active ? 'Stop service' : 'Start service'"
                                        x-show="!serverMode">
                                    <template x-if="!serviceStatus.active && getServiceStartStopState('tsupdate') === 'idle'">
                                        <i class="fas fa-play"></i>
                                    </template>
                                    <template x-if="serviceStatus.active && getServiceStartStopState('tsupdate') === 'idle'">
                                        <i class="fas fa-stop"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsupdate') === 'starting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsupdate') === 'stopping'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsupdate') === 'started'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('tsupdate') === 'stopped'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <!-- Restart button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-warning': getServiceRestartState('tsupdate') === 'idle',
                                            'btn-primary': getServiceRestartState('tsupdate') === 'restarting',
                                            'btn-outline-success': getServiceRestartState('tsupdate') === 'restarted'
                                        }"
                                        @click="performAction('tsupdate', 'restart')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceRestartState('tsupdate') === 'restarting'"
                                        title="Restart service"
                                        x-show="!serverMode">
                                    <template x-if="getServiceRestartState('tsupdate') === 'idle'">
                                        <i class="fas fa-redo"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('tsupdate') === 'restarting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('tsupdate') === 'restarted'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <button type="button" 
                                        class="btn btn-outline-info btn-sm" 
                                        @click="streamLogs('tsupdate')"
                                        title="View tsupdate service logs"
                                        x-show="!serverMode">
                                    <i class="fas fa-file-alt me-1"></i>
                                    Logs
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <form @submit.prevent="saveConfig">
                                <!-- Regular Behavior Section -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        Regular Behavior
                                    </h6>
                                    <div class="form-text mb-3">
                                        Applies outside maintenance window or when no maintenance schedule is configured.
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Check Interval</label>
                                            <input type="time" 
                                                   class="form-control" 
                                                   x-model="config.check_interval_hhmm"
                                                   required>
                                            <div class="form-text">
                                                How often the daemon checks for updates. Default: 01:00 (1 hour).
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Update Action</label>
                                            <select class="form-select" 
                                                    x-model="config.do"
                                                    required>
                                                <option value="nothing">Nothing - Skip update check entirely</option>
                                                <option value="check">Check - Check for updates but don't download or apply</option>
                                                <option value="download">Download - Check and download updates but don't apply</option>
                                                <option value="apply">Apply - Perform full update workflow (check  download  sync  apply  reboot)</option>
                                            </select>
                                            <div class="form-text">
                                                What to do when checking for updates. Default: check.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Maintenance Behavior Section -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-tools me-2"></i>
                                        Maintenance Behavior
                                    </h6>
                                    <div class="form-text mb-3">
                                        Applies inside maintenance window. If not specified, uses regular behavior settings.
                                    </div>
                                    
                                    <template x-if="maintenanceScheduleLoading">
                                        <div class="text-center py-3">
                                            <i class="fas fa-spinner fa-spin me-2"></i>
                                            Loading maintenance schedule...
                                        </div>
                                    </template>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Check Interval</label>
                                            <input type="time" 
                                                   class="form-control" 
                                                   x-model="config.maintenance_check_interval_hhmm">
                                            <div class="form-text">
                                                How often to check for updates during maintenance window. If not specified, uses the regular check interval.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Update Action</label>
                                            <select class="form-select" 
                                                    x-model="config.maintenance_do">
                                                <option :value="null">Use regular behavior</option>
                                                <option value="nothing">Nothing - Skip update check entirely</option>
                                                <option value="check">Check - Check for updates but don't download or apply</option>
                                                <option value="download">Download - Check and download updates but don't apply</option>
                                                <option value="apply">Apply - Perform full update workflow (check  download  sync  apply  reboot)</option>
                                            </select>
                                            <div class="form-text">
                                                What to do when checking for updates during maintenance window. If not specified, defaults to "apply" when maintenance schedule exists.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <template x-if="!maintenanceScheduleLoading && maintenanceSchedule">
                                        <div class="rounded-2 p-3 mb-3 bg-light border border-info border-2">
                                            <div class="d-flex align-items-center justify-content-between mb-3">
                                                <div class="d-flex align-items-center flex-grow-1 me-3">
                                                    <i class="fas fa-clock text-primary me-2"></i>
                                                    <input type="text" 
                                                            class="form-control form-control-sm fw-medium bg-secondary bg-opacity-10 text-muted" 
                                                            x-model="maintenanceSchedule.name" 
                                                            readonly
                                                            disabled>
                                                    <span class="badge bg-info text-white ms-2" title="This schedule entry is used by tsupdate">
                                                        <i class="fas fa-info-circle me-1"></i>System maintenance
                                                    </span>
                                                </div>
                                                <a href="#settings/schedule" 
                                                   class="btn btn-outline-primary btn-sm" 
                                                   title="Edit in Schedule section">
                                                    <i class="fas fa-edit me-1"></i>
                                                    Edit
                                                </a>
                                            </div>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <label class="text-success fw-semibold small mb-0 schedule-label">
                                                            <i class="fas fa-play me-1"></i><span class="d-none d-md-inline">Start</span>
                                                        </label>
                                                        <div class="row g-1 flex-grow-1">
                                                            <div class="col">
                                                                <select class="form-select form-select-sm" 
                                                                        x-model="maintenanceSchedule.startReference"
                                                                        disabled>
                                                                    <option value="time">Clock Time</option>
                                                                    <option value="sunrise">Sunrise</option>
                                                                    <option value="sunset">Sunset</option>
                                                                    <option value="dawn">Dawn</option>
                                                                    <option value="dusk">Dusk</option>
                                                                    <option value="noon">Solar Noon</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <select class="form-select form-select-sm" 
                                                                        style="width: 70px;"
                                                                        x-model="maintenanceSchedule.startSign"
                                                                        disabled>
                                                                    <option value="+">+</option>
                                                                    <option value="-">-</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <input type="time" 
                                                                        class="form-control form-control-sm" 
                                                                        style="width: 110px;"
                                                                        x-model="maintenanceSchedule.startOffset"
                                                                        disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <label class="text-danger fw-semibold small mb-0 schedule-label">
                                                            <i class="fas fa-stop me-1"></i><span class="d-none d-md-inline">Stop</span>
                                                        </label>
                                                        <div class="row g-1 flex-grow-1">
                                                            <div class="col">
                                                                <select class="form-select form-select-sm" 
                                                                        x-model="maintenanceSchedule.stopReference"
                                                                        disabled>
                                                                    <option value="time">Clock Time</option>
                                                                    <option value="sunrise">Sunrise</option>
                                                                    <option value="sunset">Sunset</option>
                                                                    <option value="dawn">Dawn</option>
                                                                    <option value="dusk">Dusk</option>
                                                                    <option value="noon">Solar Noon</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <select class="form-select form-select-sm" 
                                                                        style="width: 70px;"
                                                                        x-model="maintenanceSchedule.stopSign"
                                                                        disabled>
                                                                    <option value="+">+</option>
                                                                    <option value="-">-</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-auto">
                                                                <input type="time" 
                                                                        class="form-control form-control-sm" 
                                                                        style="width: 110px;"
                                                                        x-model="maintenanceSchedule.stopOffset"
                                                                        disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <template x-if="!maintenanceScheduleLoading && !maintenanceSchedule">
                                        <div class="alert alert-warning mb-3">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            No maintenance schedule entry found. 
                                            <a href="#settings/schedule" class="alert-link">Create a schedule entry named "maintenance"</a> in the Schedule tab.
                                        </div>
                                    </template>
                                </div>

                                <!-- Update Handling Section -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-cog me-2"></i>
                                        Update Handling
                                    </h6>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Include Pre-releases</label>
                                            <div class="form-check form-switch mt-2">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       x-model="config.include_prereleases" 
                                                       id="includePrereleases">
                                                <label class="form-check-label" for="includePrereleases">
                                                    Include beta/pre-release updates
                                                </label>
                                            </div>
                                            <div class="form-text">
                                                When enabled, the daemon will check for and apply pre-release updates.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Persist Timeout</label>
                                            <input type="time" 
                                                   class="form-control" 
                                                   x-model="config.persist_timeout_hhmm"
                                                   required>
                                            <div class="form-text">
                                                System uptime threshold before persisting tryboot configuration. Default: 00:10 (10 minutes).
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Update Countdown</label>
                                            <input type="time" 
                                                   class="form-control" 
                                                   x-model="config.update_countdown_hhmm"
                                                   required>
                                            <div class="form-text">
                                                Countdown before initiating tryboot reboot after update. Default: 00:01 (1 minute).
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- GitHub URL Override Section (Expert Mode) -->
                                <div class="mb-4" x-show="expertMode" x-transition>
                                    <h6 class="border-bottom pb-2">
                                        <i class="fab fa-github me-2"></i>
                                        Repository Settings
                                        <small class="text-muted ms-2">(Expert Mode)</small>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">GitHub URL Override (optional)</label>
                                        <input type="url" 
                                               class="form-control" 
                                               x-model="config.github_url"
                                               placeholder="https://github.com/owner/repo">
                                        <div class="form-text">
                                            Optional. Override the default GitHub repository URL. If not set, uses SUPPORT_URL from /etc/os-release.
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Max Releases</label>
                                        <input type="number" 
                                               class="form-control" 
                                               x-model.number="config.max_releases"
                                               min="1"
                                               required>
                                        <div class="form-text">
                                            Maximum number of recent releases to check for batch updates. Default: 5.
                                        </div>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="d-flex justify-content-between gap-2">
                                    <div class="d-flex gap-2">
                                        <button type="button" 
                                                class="btn btn-outline-secondary" 
                                                @click="refreshConfig()">
                                            Reset
                                        </button>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" 
                                                class="btn"
                                                :class="{
                                                    'btn-success': saveState === 'idle',
                                                    'btn-primary': saveState === 'saving',
                                                    'btn-outline-success': saveState === 'saved'
                                                }"
                                                :disabled="saveState === 'saving'">
                                            <template x-if="saveState === 'idle'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-save me-1"></i>
                                                    Save
                                                </div>
                                            </template>
                                            <template x-if="saveState === 'saving'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Saving...
                                                </div>
                                            </template>
                                            <template x-if="saveState === 'saved'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-check me-1"></i>
                                                    Saved!
                                                </div>
                                            </template>
                                        </button>
                                        <button type="button" 
                                                class="btn"
                                                :class="{
                                                    'btn-warning': saveRestartState === 'idle',
                                                    'btn-primary': saveRestartState === 'saving' || saveRestartState === 'restarting',
                                                    'btn-outline-success': saveRestartState === 'saved'
                                                }"
                                                @click="saveAndRestartService()"
                                                :disabled="saveRestartState === 'saving' || saveRestartState === 'restarting'"
                                                x-show="!serverMode">
                                            <template x-if="saveRestartState === 'idle'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-save me-1"></i>
                                                    <i class="fas fa-redo me-1"></i>
                                                    Save & Restart
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'saving'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Saving...
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'restarting'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-spinner fa-spin me-1"></i>
                                                    Restarting...
                                                </div>
                                            </template>
                                            <template x-if="saveRestartState === 'saved'">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-check me-1"></i>
                                                    Saved & Restarted!
                                                </div>
                                            </template>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Network Tab -->
                <template x-if="!serverMode">
                    <div x-show="systemTab === 'network'">
                        <div class="card" x-data="networkConfig()" x-init="init()" x-destroy="cleanup()">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <h5 class="card-title mb-0 me-2">NetworkManager</h5>
                                <!-- Service Status Indicator -->
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge d-flex align-items-center gap-1" 
                                            :class="{
                                                'bg-success': serviceStatus.active && serviceStatus.status === 'active',
                                                'bg-danger': !serviceStatus.active && serviceStatus.status !== 'not-found' && serviceStatus.status !== 'timeout' && serviceStatus.status !== 'error' && serviceStatus.status !== 'unknown',
                                                'bg-secondary': serviceStatus.status === 'not-found' || serviceStatus.status === 'unknown',
                                                'bg-warning': serviceStatus.status === 'timeout' || serviceStatus.status === 'error'
                                            }">
                                        <span class="d-none d-sm-inline" x-text="serviceStatus.active ? 'Active' : (serviceStatus.status === 'not-found' ? 'Not Found' : (serviceStatus.status === 'timeout' || serviceStatus.status === 'error' ? 'Error' : 'Inactive'))"></span>
                                        <span class="d-sm-none" x-text="serviceStatus.active ? 'ON' : 'OFF'"></span>
                                    </span>
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        <span x-text="serviceStatus.uptime"></span>
                                    </small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <!-- Start/Stop button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-success': (!serviceStatus.active && getServiceStartStopState('NetworkManager') === 'idle') || getServiceStartStopState('NetworkManager') === 'started',
                                            'btn-success': getServiceStartStopState('NetworkManager') === 'starting',
                                            'btn-outline-danger': (serviceStatus.active && getServiceStartStopState('NetworkManager') === 'idle') || getServiceStartStopState('NetworkManager') === 'stopped',
                                            'btn-danger': getServiceStartStopState('NetworkManager') === 'stopping'
                                        }"
                                        @click="performStartStopAction('NetworkManager', serviceStatus.active ? 'stop' : 'start')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceStartStopState('NetworkManager') === 'starting' || getServiceStartStopState('NetworkManager') === 'stopping'"
                                        :title="serviceStatus.active ? 'Stop service' : 'Start service'">
                                    <template x-if="!serviceStatus.active && getServiceStartStopState('NetworkManager') === 'idle'">
                                        <i class="fas fa-play"></i>
                                    </template>
                                    <template x-if="serviceStatus.active && getServiceStartStopState('NetworkManager') === 'idle'">
                                        <i class="fas fa-stop"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('NetworkManager') === 'starting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('NetworkManager') === 'stopping'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('NetworkManager') === 'started'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                    <template x-if="getServiceStartStopState('NetworkManager') === 'stopped'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <!-- Restart button -->
                                <button type="button" 
                                        class="btn btn-sm" 
                                        :class="{
                                            'btn-outline-warning': getServiceRestartState('NetworkManager') === 'idle',
                                            'btn-primary': getServiceRestartState('NetworkManager') === 'restarting',
                                            'btn-outline-success': getServiceRestartState('NetworkManager') === 'restarted'
                                        }"
                                        @click="performAction('NetworkManager', 'restart')"
                                        :disabled="actionLoading || serviceStatus.status === 'not-found' || getServiceRestartState('NetworkManager') === 'restarting'"
                                        title="Restart service">
                                    <template x-if="getServiceRestartState('NetworkManager') === 'idle'">
                                        <i class="fas fa-redo"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('NetworkManager') === 'restarting'">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </template>
                                    <template x-if="getServiceRestartState('NetworkManager') === 'restarted'">
                                        <i class="fas fa-check"></i>
                                    </template>
                                </button>
                                <button type="button" 
                                        class="btn btn-outline-info btn-sm" 
                                        @click="streamLogs('NetworkManager')"
                                        title="View NetworkManager service logs">
                                    <i class="fas fa-file-alt me-1"></i>
                                    Logs
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Connection Status Section -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list me-2"></i>
                                        Network Connections
                                    </h6>
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-primary" 
                                            @click="refreshConnections()"
                                            :disabled="refreshing"
                                            title="Refresh network connections">
                                        <i class="fas" :class="refreshing ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
                                        <span class="d-none d-sm-inline ms-1">Refresh</span>
                                    </button>
                                </div>
                                
                                <template x-if="connections.length === 0">
                                    <div class="text-muted text-center py-4">
                                        <i class="fas fa-network-wired fa-3x mb-3 opacity-25"></i>
                                        <p>No network connections found.</p>
                                    </div>
                                </template>

                                <template x-if="connections.length > 0">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th style="width: 150px;">Name</th>
                                                    <th style="width: 80px;">Type</th>
                                                    <th style="width: 100px;">Device</th>
                                                    <th style="width: 150px;" class="text-end">IPv4 Address</th>
                                                    <th style="width: 120px;" class="text-end">Status</th>
                                                    <th style="width: 80px;" class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template x-for="connection in connections" :key="connection.name">
                                                    <tr>
                                                        <td>
                                                            <i :class="getConnectionTypeIcon(connection.type)" class="fa-fw me-1"></i>
                                                            <span x-text="connection.name"></span>
                                                        </td>
                                                        <td>
                                                            <small class="text-muted" x-text="connection.type"></small>
                                                        </td>
                                                        <td>
                                                            <code class="small" x-text="connection.device || '-'"></code>
                                                        </td>
                                                        <td class="text-end">
                                                            <code class="small" x-text="connection.ipv4_address || '-'"></code>
                                                        </td>
                                                        <td class="text-end">
                                                            <span class="badge" 
                                                                  :class="getConnectionStatusBadgeClass(connection.state)"
                                                                  x-text="getConnectionStatusText(connection.state)">
                                                            </span>
                                                        </td>
                                                        <td class="text-end">
                                                            <button type="button" 
                                                                    class="btn btn-sm" 
                                                                    :class="{
                                                                        'btn-outline-success': getConnectionUpState(connection.name) === 'idle',
                                                                        'btn-success': getConnectionUpState(connection.name) === 'activating',
                                                                        'btn-outline-primary': getConnectionUpState(connection.name) === 'activated'
                                                                    }"
                                                                    @click="bringConnectionUp(connection.name)"
                                                                    :disabled="getConnectionUpState(connection.name) === 'activating'"
                                                                    :title="'Bring connection up'">
                                                                <template x-if="getConnectionUpState(connection.name) === 'idle'">
                                                                    <i class="fas fa-play"></i>
                                                                </template>
                                                                <template x-if="getConnectionUpState(connection.name) === 'activating'">
                                                                    <i class="fas fa-spinner fa-spin"></i>
                                                                </template>
                                                                <template x-if="getConnectionUpState(connection.name) === 'activated'">
                                                                    <i class="fas fa-check"></i>
                                                                </template>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </template>
                            </div>

                            <!-- Hotspot Configuration Section -->
                            <div class="mb-4">
                                <h6 class="border-bottom pb-2">
                                    <i class="fas fa-wifi me-2"></i>
                                    Hotspot Configuration
                                </h6>
                                <p class="text-muted small mb-3">
                                    The SSID is configured from the hostname on boot. Only the password can be changed.
                                </p>
                                
                                <form @submit.prevent="saveHotspotConfig">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">SSID (Network Name)</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   :value="hotspot.ssid"
                                                   readonly
                                                   disabled>
                                            <div class="form-text">
                                                Read-only. Configured from hostname on boot.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Password</label>
                                            <div class="input-group">
                                                <input :type="showPassword ? 'text' : 'password'" 
                                                       class="form-control" 
                                                       x-model="hotspot.password"
                                                       placeholder="Enter hotspot password"
                                                       minlength="8"
                                                       maxlength="63"
                                                       autocomplete="off"
                                                       required>
                                                <button class="btn btn-outline-secondary" 
                                                        type="button"
                                                        @click="togglePasswordVisibility()"
                                                        :title="showPassword ? 'Hide password' : 'Show password'">
                                                    <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                                </button>
                                            </div>
                                            <div class="form-text">
                                                8-63 characters. Required for WPA2 security. Default: <code>BirdsAndBats</code>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Expert Mode WiFi Settings -->
                                    <div class="row" x-show="expertMode" x-transition>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Band <small class="text-muted">(Expert)</small></label>
                                            <select class="form-select" 
                                                    x-model="hotspot.band"
                                                    @change="onBandChange()">
                                                <option value="">Auto</option>
                                                <template x-for="bandInfo in wifiCapabilities.bands" :key="bandInfo.band">
                                                    <option :value="bandInfo.band" x-text="bandInfo.band"></option>
                                                </template>
                                            </select>
                                            <div class="form-text">WiFi frequency band</div>
                                        </div>
                                        
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Channel <small class="text-muted">(Expert)</small></label>
                                            <select class="form-select" x-model.number="hotspot.channel">
                                                <option value="">Auto</option>
                                                <template x-for="channel in availableChannels" :key="channel">
                                                    <option :value="channel" x-text="channel"></option>
                                                </template>
                                            </select>
                                            <div class="form-text">WiFi channel (auto recommended)</div>
                                        </div>
                                        
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Channel Width <small class="text-muted">(Expert)</small></label>
                                            <select class="form-select" x-model="hotspot.channel_width">
                                                <option value="">Auto</option>
                                                <template x-for="width in wifiCapabilities.channel_widths" :key="width">
                                                    <option :value="width" x-text="width + ' MHz'"></option>
                                                </template>
                                            </select>
                                            <div class="form-text">Channel bandwidth</div>
                                        </div>
                                        
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Hidden SSID <small class="text-muted">(Expert)</small></label>
                                            <div class="form-check form-switch mt-2">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       x-model="hotspot.hidden"
                                                       id="hotspotHidden">
                                                <label class="form-check-label" for="hotspotHidden">
                                                    Hide network name
                                                </label>
                                            </div>
                                            <div class="form-text">Network won't appear in WiFi lists</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Form Actions -->
                                    <div class="d-flex justify-content-between gap-2">
                                        <div class="d-flex gap-2">
                                            <button type="button" 
                                                    class="btn btn-outline-secondary" 
                                                    @click="resetHotspotConfig()"
                                                    :disabled="!isModified">
                                                Reset
                                            </button>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="submit" 
                                                    class="btn"
                                                    :class="{
                                                        'btn-success': saveState === 'idle',
                                                        'btn-primary': saveState === 'saving',
                                                        'btn-outline-success': saveState === 'saved'
                                                    }"
                                                    :disabled="saveState === 'saving' || !isModified">
                                                <template x-if="saveState === 'idle'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-save me-1"></i>
                                                        Save
                                                    </div>
                                                </template>
                                                <template x-if="saveState === 'saving'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-spinner fa-spin me-1"></i>
                                                        Saving...
                                                    </div>
                                                </template>
                                                <template x-if="saveState === 'saved'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-check me-1"></i>
                                                        Saved!
                                                    </div>
                                                </template>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- Cellular Configuration Section -->
                            <div class="mb-4">
                                <h6 class="border-bottom pb-2">
                                    <i class="fas fa-signal me-2"></i>
                                    Cellular Configuration
                                </h6>
                                <p class="text-muted small mb-3">
                                    Configure GSM/cellular network settings. All fields are optional.
                                </p>
                                
                                <form @submit.prevent="saveCellularConfig">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">APN (Access Point Name)</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   x-model="cellular.apn"
                                                   placeholder="e.g., internet, iot.melita.io">
                                            <div class="form-text">
                                                Optional. The APN provided by your cellular carrier.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Username</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   x-model="cellular.username"
                                                   placeholder="Enter username if required">
                                            <div class="form-text">
                                                Optional. Authentication username for your carrier.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Password</label>
                                            <div class="input-group">
                                                <input :type="showCellularPassword ? 'text' : 'password'" 
                                                       class="form-control" 
                                                       x-model="cellular.password"
                                                       placeholder="Enter password if required"
                                                       autocomplete="off">
                                                <button class="btn btn-outline-secondary" 
                                                        type="button"
                                                        @click="toggleCellularPasswordVisibility()"
                                                        :title="showCellularPassword ? 'Hide password' : 'Show password'">
                                                    <i :class="showCellularPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                                </button>
                                            </div>
                                            <div class="form-text">
                                                Optional. Authentication password for your carrier.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">SIM PIN</label>
                                            <div class="input-group">
                                                <input :type="showCellularPin ? 'text' : 'password'" 
                                                       class="form-control" 
                                                       x-model="cellular.pin"
                                                       placeholder="Enter 4-8 digit PIN"
                                                       pattern="\d{4,8}"
                                                       autocomplete="off">
                                                <button class="btn btn-outline-secondary" 
                                                        type="button"
                                                        @click="toggleCellularPinVisibility()"
                                                        :title="showCellularPin ? 'Hide PIN' : 'Show PIN'">
                                                    <i :class="showCellularPin ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                                </button>
                                            </div>
                                            <div class="form-text">
                                                Optional. 4-8 digit SIM card PIN code.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Form Actions -->
                                    <div class="d-flex justify-content-between gap-2">
                                        <div class="d-flex gap-2">
                                            <button type="button" 
                                                    class="btn btn-outline-secondary" 
                                                    @click="resetCellularConfig()"
                                                    :disabled="!isCellularModified">
                                                Reset
                                            </button>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="submit" 
                                                    class="btn"
                                                    :class="{
                                                        'btn-success': cellularSaveState === 'idle',
                                                        'btn-primary': cellularSaveState === 'saving',
                                                        'btn-outline-success': cellularSaveState === 'saved'
                                                    }"
                                                    :disabled="cellularSaveState === 'saving' || !isCellularModified">
                                                <template x-if="cellularSaveState === 'idle'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-save me-1"></i>
                                                        Save
                                                    </div>
                                                </template>
                                                <template x-if="cellularSaveState === 'saving'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-spinner fa-spin me-1"></i>
                                                        Saving...
                                                    </div>
                                                </template>
                                                <template x-if="cellularSaveState === 'saved'">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-check me-1"></i>
                                                        Saved!
                                                    </div>
                                                </template>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- Modem Details Section -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                                    <h6 class="mb-0">
                                        <i class="fas fa-mobile-alt me-2"></i>
                                        Modem Details
                                    </h6>
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-primary" 
                                            @click="refreshModemDetails()"
                                            :disabled="modemLoading"
                                            title="Refresh modem details">
                                        <i class="fas" :class="modemLoading ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
                                        <span class="d-none d-sm-inline ms-1">Refresh</span>
                                    </button>
                                </div>
                                
                                <!-- No modem message -->
                                <template x-if="!modem && !modemError">
                                    <div class="text-muted text-center py-4">
                                        <i class="fas fa-mobile-alt fa-3x mb-3 opacity-25"></i>
                                        <p>No modem detected</p>
                                    </div>
                                </template>

                                <!-- Error message -->
                                <template x-if="modemError">
                                    <div class="alert alert-warning" role="alert">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <span x-text="modemError"></span>
                                    </div>
                                </template>

                                <!-- Modem information -->
                                <template x-if="modem">
                                    <div>
                                        <!-- General Information -->
                                        <div class="mb-3">
                                            <h6 class="text-muted small fw-semibold mb-2">General Information</h6>
                                            <div class="row g-2">
                                                <div class="col-md-6">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Manufacturer</small>
                                                        <span x-text="modem.manufacturer || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Model</small>
                                                        <span x-text="modem.model || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Hardware Revision</small>
                                                        <span x-text="modem.hardware_revision || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">IMEI</small>
                                                        <code class="small" x-text="modem.imei || '-'"></code>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Signal Information -->
                                        <div class="mb-3">
                                            <h6 class="text-muted small fw-semibold mb-2">Signal Information</h6>
                                            <div class="row g-2">
                                                <div class="col-md-3 d-flex">
                                                    <div class="bg-light rounded p-2 flex-fill">
                                                        <small class="text-muted d-block">Operator</small>
                                                        <span x-text="modem.operator_name || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 d-flex">
                                                    <div class="bg-light rounded p-2 flex-fill">
                                                        <small class="text-muted d-block">Technology</small>
                                                        <span x-text="modem.access_technology || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 d-flex">
                                                    <div class="bg-light rounded p-2 flex-fill">
                                                        <small class="text-muted d-block">State</small>
                                                        <span class="badge" 
                                                              :class="getModemStateBadgeClass(modem.state)"
                                                              x-text="modem.state || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 d-flex">
                                                    <div class="bg-light rounded p-2 flex-fill">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <small class="text-muted">Signal Strength</small>
                                                            <small class="fw-semibold" x-text="modem.signal_strength_percent !== null && modem.signal_strength_percent !== undefined ? modem.signal_strength_percent + '%' : '-'"></small>
                                                        </div>
                                                        <template x-if="modem.signal_strength_percent !== null && modem.signal_strength_percent !== undefined">
                                                            <div class="progress mt-2">
                                                                <div class="progress-bar" 
                                                                        :style="`width: ${modem.signal_strength_percent}%`" 
                                                                        :class="{
                                                                            'bg-success': modem.signal_strength_percent >= 60,
                                                                            'bg-warning': modem.signal_strength_percent >= 40 && modem.signal_strength_percent < 60,
                                                                            'bg-danger': modem.signal_strength_percent < 40
                                                                        }">
                                                                </div>
                                                            </div>
                                                        </template>
                                                        <template x-if="modem.signal_strength_percent === null || modem.signal_strength_percent === undefined">
                                                            <span>-</span>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- SIM Card Information -->
                                        <div>
                                            <h6 class="text-muted small fw-semibold mb-2">SIM Card</h6>
                                            <div class="row g-2">
                                                <div class="col-md-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Operator</small>
                                                        <span x-text="modem.sim_operator || '-'"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">ICCID</small>
                                                        <code class="small" x-text="modem.sim_iccid || '-'"></code>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">IMSI</small>
                                                        <code class="small" x-text="modem.sim_imsi || '-'"></code>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        </div>
                    </div>
                </template>

                <!-- Config Upload Tab -->
                <template x-if="!serverMode">
                    <div x-show="systemTab === 'configupload'">
                        <div class="card" x-data="configUpload()" x-init="init()">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-file-archive me-2"></i>
                                Configuration Upload
                            </h5>
                        </div>
                        <div class="card-body">
                            <form @submit.prevent="uploadConfig" enctype="multipart/form-data">
                                <!-- File Selection -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-file me-2"></i>
                                        Select Configuration ZIP
                                    </h6>
                                    <div class="mb-3">
                                        <label class="form-label">Configuration ZIP File</label>
                                        <input type="file" 
                                               class="form-control" 
                                               @change="handleFileChange"
                                               accept=".zip"
                                               :disabled="uploading"
                                               required>
                                        <div class="form-text">
                                            Upload a ZIP file containing configuration files. All files will be validated before applying any changes. 
                                            Supported: <code>radiotracking.ini</code>, <code>schedule.yml</code>, <code>soundscapepipe.yml</code>, 
                                            <code>authorized_keys</code>, <code>cmdline.txt</code>, <code>wireguard.conf</code>, <code>server.crt</code>, 
                                            <code>server.conf</code>, <code>geolocation</code>.
                                        </div>
                                        <template x-if="selectedFile">
                                            <div class="mt-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-file-archive me-1"></i>
                                                    Selected: <span x-text="selectedFile.name"></span>
                                                    (<span x-text="formatFileSize(selectedFile.size)"></span>)
                                                </small>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <!-- Upload Options -->
                                <div class="mb-4">
                                    <h6 class="border-bottom pb-2">
                                        <i class="fas fa-cog me-2"></i>
                                        Upload Options
                                    </h6>
                                    
                                    <!-- Force Overwrite -->
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   x-model="options.force" 
                                                   id="forceOverwrite"
                                                   :disabled="uploading">
                                            <label class="form-check-label" for="forceOverwrite">
                                                <strong>Force Overwrite</strong>
                                            </label>
                                        </div>
                                        <div class="form-text ms-4">
                                            When enabled, all files will be overwritten regardless of modification timestamps. 
                                            When disabled, only newer files will be applied.
                                        </div>
                                    </div>

                                    <!-- Pedantic Mode -->
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   x-model="options.pedantic" 
                                                   id="pedanticMode"
                                                   :disabled="uploading || options.force">
                                            <label class="form-check-label" for="pedanticMode">
                                                <strong>Pedantic Mode</strong>
                                            </label>
                                        </div>
                                        <div class="form-text ms-4">
                                            Reject upload if any existing file is newer than the ZIP version, or if unknown files are present.
                                            This option is ignored when Force Overwrite is enabled.
                                        </div>
                                    </div>

                                    <!-- Restart Services -->
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   x-model="options.restartServices" 
                                                   id="restartServices"
                                                   :disabled="uploading || options.reboot">
                                            <label class="form-check-label" for="restartServices">
                                                <strong>Restart Services</strong>
                                            </label>
                                        </div>
                                        <div class="form-text ms-4">
                                            Automatically restart affected services after successfully applying the configuration. 
                                            This option is ignored if Force Reboot is enabled.
                                        </div>
                                    </div>

                                    <!-- System Reboot -->
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   x-model="options.reboot" 
                                                   id="systemReboot"
                                                   :disabled="uploading">
                                            <label class="form-check-label" for="systemReboot">
                                                <strong>Force Reboot</strong>
                                                <i class="fas fa-exclamation-triangle text-warning ms-1"></i>
                                            </label>
                                        </div>
                                        <div class="form-text ms-4">
                                            <strong>OFF (default):</strong> Reboot only if cmdline.txt is updated (smart mode).<br>
                                            <strong>ON:</strong> Always reboot after successfully applying any configuration.
                                            Reboot will restart all services and temporarily interrupt connectivity.
                                        </div>
                                    </div>
                                </div>

                                <!-- Upload Button -->
                                <div class="d-grid gap-2">
                                    <button type="submit" 
                                            class="btn btn-lg"
                                            :class="{
                                                'btn-primary': !uploading && !uploadSuccess,
                                                'btn-success': uploadSuccess,
                                                'btn-secondary': uploading
                                            }"
                                            :disabled="uploading || !selectedFile">
                                        <template x-if="!uploading && !uploadSuccess">
                                            <span>
                                                <i class="fas fa-upload me-2"></i>
                                                Upload Configuration
                                            </span>
                                        </template>
                                        <template x-if="uploading">
                                            <span>
                                                <i class="fas fa-spinner fa-spin me-2"></i>
                                                Uploading...
                                            </span>
                                        </template>
                                        <template x-if="uploadSuccess">
                                            <span>
                                                <i class="fas fa-check me-2"></i>
                                                Upload Successful!
                                            </span>
                                        </template>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>

